--!strict
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

player.CharacterAdded:Connect(function(char)
	character = char
end)

-- ================= GUI =================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player:WaitForChild("PlayerGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 180)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -90)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

-- 拖動系統
local dragging = false
local dragInput
local dragStart
local startPos

local function update(input)
	local delta = input.Position - dragStart
	MainFrame.Position = UDim2.new(
		startPos.X.Scale,
		startPos.X.Offset + delta.X,
		startPos.Y.Scale,
		startPos.Y.Offset + delta.Y
	)
end

MainFrame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = MainFrame.Position

		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

MainFrame.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		update(input)
	end
end)

-- 關閉按鈕
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 5)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.Parent = MainFrame

CloseButton.MouseButton1Click:Connect(function()
	ScreenGui:Destroy()
end)

-- ================= Auto Attack =================
local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(0, 260, 0, 45)
ToggleButton.Position = UDim2.new(0.5, -130, 0, 50)
ToggleButton.Text = "Auto Attack: OFF"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
ToggleButton.Parent = MainFrame

local autoAttack = false

ToggleButton.MouseButton1Click:Connect(function()
	autoAttack = not autoAttack
	ToggleButton.Text = "Auto Attack: " .. (autoAttack and "ON" or "OFF")
end)

-- ================= 攻擊設定 =================
local attackInterval = 0.01 -- 攻速
local attackTimer = 0

local RANGE_MULTIPLIER = 1000 -- 永久放大倍數

-- ================= 核心攻擊邏輯 =================
RunService.Heartbeat:Connect(function(dt)
	if not autoAttack then return end
	if not character then return end

	local tool = character:FindFirstChildOfClass("Tool")
	if not tool then return end

	attackTimer += dt
	if attackTimer < attackInterval then return end
	attackTimer = 0

	local handle = tool:FindFirstChild("Handle")
	if handle and not handle:GetAttribute("HitboxExpanded") then
		-- 永久放大 Hitbox
		handle.Size = handle.Size * RANGE_MULTIPLIER
		handle.Transparency = 1
		handle.CanCollide = false
		handle:SetAttribute("HitboxExpanded", true)
	end

	tool:Activate()
end)
