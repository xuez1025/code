local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CommF = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommF_")

local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

-- å»ºç«‹è¦–çª—ï¼ˆå·²æ•´åˆ OpenButtonï¼‰
local Window = WindUI:CreateWindow({
    Title = "Xu-hub",
    Icon = "user-check",
    Author = "by xuez1025",
    Folder = "Xu-Hub",
    Size = UDim2.fromOffset(600, 400),
    Transparent = true,
    Theme = "Dark",

    -- âœ… ä½¿ç”¨è€…é ­åƒ / Profile
    User = {
        Enabled = true,
        Anonymous = false,
        Callback = function()
            WindUI:Notify({
                Title = "User Profile",
                Content = "User profile clicked!",
                Duration = 3
            })
        end
    },

    -- âœ… è¦–è¦º / ä»‹é¢è¨­å®š
    Acrylic = false,
    HideSearchBar = false,
    SideBarWidth = 200,

    -- ğŸ”½ ç¸®å°å¾Œé¡¯ç¤ºçš„æµ®å‹•æŒ‰éˆ•
    OpenButton = {
        Title = "Open Xu-hub",
        CornerRadius = UDim.new(1, 0), -- å®Œå…¨åœ“å½¢
        StrokeThickness = 3,
        Enabled = true,
        OnlyMobile = false,
        Draggable = true,
        OnlyIcon = false,

        Color = ColorSequence.new(
    Color3.fromHex("#7F00FF"),
    Color3.fromHex("#00C6FF")
),
    }
})

-- è‡ªå‹•å•Ÿç”¨ AutoBuso
AutoBuso = true
if AutoBuso then
    pcall(function()
        if Player.Character and not Player.Character:FindFirstChild("HasBuso") then
            CommF:InvokeServer("Buso")
        end
    end)
end

-- è‡ªå‹•æ­¦è£è‰²é‚è¼¯å¾ªç’°
task.spawn(function()
    while task.wait(1) do
        if AutoBuso then
            pcall(function()
                if Player.Character and not Player.Character:FindFirstChild("HasBuso") then
                    CommF:InvokeServer("Buso")
                end
            end)
        end
    end
end)

local VirtualInputManager = game:GetService("VirtualInputManager")

local AutoV3 = {
    Enabled = false,
    _task = nil
}

local function StartAutoV3()
    if AutoV3._task then return end

    AutoV3._task = task.spawn(function()
        while AutoV3.Enabled do
            -- æŒ‰ä¸‹ T
            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.T, false, game)
            task.wait(0.01)
            -- æ”¾é–‹ T
            VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.T, false, game)
            task.wait(0.1)
        end
        AutoV3._task = nil
    end)
end

local function StopAutoV3()
    AutoV3.Enabled = false
end

--// ç‹€æ…‹
local AutoV4 = false
local autoV4Connection = nil

-- ================= å–å¾— Awakening RemoteFunction =================
local function getAwakeningRemote()
    local backpack = Player:FindFirstChild("Backpack")
    if backpack then
        local awakening = backpack:FindFirstChild("Awakening")
        if awakening then
            return awakening:FindFirstChild("RemoteFunction")
        end
    end
    return nil
end

local Tabs = {
    General  = Window:Tab({ Title = "é€šç”¨",   Icon = "house" }),
    Server   = Window:Tab({ Title = "Server", Icon = "server" }),
    Status   = Window:Tab({ Title = "ç‹€æ…‹",   Icon = "activity" }),
    PVP      = Window:Tab({ Title = "PVP",    Icon = "swords" }),
    Farm     = Window:Tab({ Title = "Farm",   Icon = "leaf" }),
    Auto     = Window:Tab({ Title = "è‡ªå‹•",   Icon = "cpu" }),
    Settings = Window:Tab({ Title = "è¨­å®š",   Icon = "settings" }),
    Teleport = Window:Tab({ Title = "å‚³é€",   Icon = "map-pin" }),
    Fun      = Window:Tab({ Title = "å¨›æ¨‚",   Icon = "smile" }),
    Other    = Window:Tab({ Title = "å…¶ä»–",   Icon = "ellipsis" }),
}

Tabs.General:Section({ Title = "é€šç”¨" })

Tabs.Server:Section({ Title = "Server" })

Tabs.Status:Section({ Title = "ç‹€æ…‹" })

Tabs.PVP:Section({ Title = "PVP" })

Tabs.Farm:Section({ Title = "Farm Setting" })

Tabs.Auto:Section({ Title = "è‡ªå‹•" })

Tabs.Auto:Toggle({
    Title = "è‡ªå‹•æ­¦è£è‰²",
    Desc = "è‡ªå‹•é–‹å•Ÿæˆ–é—œé–‰æ­¦è£è‰²",
    Value = true, -- åˆå§‹ç‚º ON
    Callback = function(state)
        AutoBuso = state
        print("AutoBuso ç‹€æ…‹:", AutoBuso)

        -- åˆå§‹å•Ÿå‹•æ™‚ç«‹å³å‘¼å«ä¸€æ¬¡
        if AutoBuso then
            pcall(function()
                if Player.Character and not Player.Character:FindFirstChild("HasBuso") then
                    CommF:InvokeServer("Buso")
                end
            end)
        end
    end
})

Tabs.Auto:Toggle({
    Title = "è‡ªå‹• v3",
    Desc = "è‡ªå‹•é–‹å•Ÿæˆ–é—œé–‰v3",
    Value = false, -- åˆå§‹ç‚º OFF
    Callback = function(state)
        AutoV3.Enabled = state
        print("è‡ªå‹• v3 ç‹€æ…‹:", state)

        if state then
            StartAutoV3()
        else
            StopAutoV3()
        end
    end
})

Tabs.Auto:Toggle({
    Title = "è‡ªå‹• V4",
    Desc = "è‡ªå‹•é–‹å•Ÿæˆ–é—œé–‰v4",
    Value = false, -- åˆå§‹é—œé–‰
    Callback = function(state)
        AutoV4 = state
        print("è‡ªå‹• v3 ç‹€æ…‹:", AutoV4)

        -- é—œé–‰æ™‚ä¸­æ–·èˆŠé€£ç·š
        if autoV4Connection then
            autoV4Connection:Disconnect()
            autoV4Connection = nil
        end

        -- é–‹å•Ÿè‡ªå‹• V4
        if AutoV4 then
            -- ç«‹å³å‘¼å«ä¸€æ¬¡
            pcall(function()
                local remote = getAwakeningRemote()
                if remote then
                    remote:InvokeServer(true)
                end
            end)

            -- Heartbeat æŒçºŒå‘¼å«
            autoV4Connection = RunService.Heartbeat:Connect(function()
                local remote = getAwakeningRemote()
                if remote then
                    pcall(function()
                        remote:InvokeServer(true)
                    end)
                end
            end)
        end
    end
})

Tabs.Settings:Section({ Title = "è¨­å®š" })

Tabs.Teleport:Section({ Title = "å‚³é€" })

Tabs.Fun:Section({ Title = "å¨›æ¨‚" })

Tabs.Other:Section({ Title = "å…¶ä»–" })
