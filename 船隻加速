-- ================= Services =================
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local Player = Players.LocalPlayer

-- ================= 設定 =================
local MAX_BOAT_SPEED = 500
local CURRENT_BOAT_SPEED = 200
local IS_SPEED_ACTIVE = false

-- ================= 狀態 =================
local ACTIVE_SEAT = nil
local ORIGINAL_SEAT_SPEED = nil

-- ================= GUI =================
local ScreenGui = Instance.new("ScreenGui", Player.PlayerGui)
ScreenGui.ResetOnSpawn = false

local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.fromScale(0.28, 0.28)
Main.Position = UDim2.fromScale(0.36, 0.32)
Main.BackgroundColor3 = Color3.fromRGB(25,25,25)
Main.Active = true
Main.Draggable = true

local Title = Instance.new("TextLabel", Main)
Title.Size = UDim2.new(1,0,0.2,0)
Title.Text = "Boat Speed Control"
Title.TextColor3 = Color3.new(1,1,1)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 20

local Toggle = Instance.new("TextButton", Main)
Toggle.Size = UDim2.fromScale(0.8,0.22)
Toggle.Position = UDim2.fromScale(0.1,0.3)
Toggle.Text = "速度修改：關閉"
Toggle.BackgroundColor3 = Color3.fromRGB(70,70,70)
Toggle.TextColor3 = Color3.new(1,1,1)
Toggle.Font = Enum.Font.SourceSansBold
Toggle.TextSize = 18

local SliderBg = Instance.new("Frame", Main)
SliderBg.Size = UDim2.fromScale(0.8,0.1)
SliderBg.Position = UDim2.fromScale(0.1,0.62)
SliderBg.BackgroundColor3 = Color3.fromRGB(50,50,50)

local SliderFill = Instance.new("Frame", SliderBg)
SliderFill.BackgroundColor3 = Color3.fromRGB(0,170,255)
SliderFill.Size = UDim2.new(CURRENT_BOAT_SPEED / MAX_BOAT_SPEED,0,1,0)

local SpeedText = Instance.new("TextLabel", Main)
SpeedText.Size = UDim2.fromScale(1,0.15)
SpeedText.Position = UDim2.fromScale(0,0.75)
SpeedText.Text = "Speed : "..CURRENT_BOAT_SPEED
SpeedText.TextColor3 = Color3.new(1,1,1)
SpeedText.BackgroundTransparency = 1
SpeedText.Font = Enum.Font.SourceSansBold
SpeedText.TextSize = 18

-- ================= 開關 =================
Toggle.MouseButton1Click:Connect(function()
	IS_SPEED_ACTIVE = not IS_SPEED_ACTIVE
	Toggle.Text = "速度修改："..(IS_SPEED_ACTIVE and "開啟" or "關閉")
	Toggle.BackgroundColor3 = IS_SPEED_ACTIVE and Color3.fromRGB(0,120,0) or Color3.fromRGB(70,70,70)
	if ACTIVE_SEAT then
		ACTIVE_SEAT.MaxSpeed = IS_SPEED_ACTIVE and CURRENT_BOAT_SPEED or ORIGINAL_SEAT_SPEED
	end
end)

-- ================= 滑桿 =================
local dragging = false
SliderBg.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
	end
end)
UserInputService.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = false
	end
end)

RunService.RenderStepped:Connect(function()
	if dragging then
		local x = UserInputService:GetMouseLocation().X
		local p = math.clamp((x - SliderBg.AbsolutePosition.X) / SliderBg.AbsoluteSize.X, 0, 1)
		CURRENT_BOAT_SPEED = math.floor(p * MAX_BOAT_SPEED)
		TweenService:Create(SliderFill, TweenInfo.new(0.05), {Size = UDim2.new(p,0,1,0)}):Play()
		SpeedText.Text = "Speed : "..CURRENT_BOAT_SPEED
		if IS_SPEED_ACTIVE and ACTIVE_SEAT then
			ACTIVE_SEAT.MaxSpeed = CURRENT_BOAT_SPEED
		end
	end
end)

-- ================= 坐船偵測 =================
local function onCharacter(char)
	local hum = char:WaitForChild("Humanoid")

	hum.Seated:Connect(function(sitting, seat)
		if sitting and seat:IsA("VehicleSeat") then
			ACTIVE_SEAT = seat
			ORIGINAL_SEAT_SPEED = seat.MaxSpeed
			if IS_SPEED_ACTIVE then
				seat.MaxSpeed = CURRENT_BOAT_SPEED
			end
		elseif ACTIVE_SEAT then
			ACTIVE_SEAT.MaxSpeed = ORIGINAL_SEAT_SPEED
			ACTIVE_SEAT = nil
			ORIGINAL_SEAT_SPEED = nil
		end
	end)
end

if Player.Character then onCharacter(Player.Character) end
Player.CharacterAdded:Connect(onCharacter)
